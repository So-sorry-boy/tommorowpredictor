<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tomorrow Day Predictor</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Playfair+Display:wght@400;700&family=Roboto:wght@400;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  
  <style>
    :root{
      --bg: #0a0a0a;
      --card-bg: rgba(0,0,0,0.55);
      --text: #ffffff;
      --muted: #ffffffcc;
      --control-bg: #161616;
      --accent: #a8b3ff;
      --accent-dark: #6d7bff;
      --banner-bg: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      --font-family: 'Roboto', system-ui, -apple-system, 'Segoe UI', sans-serif;
    }

    /* Theme: light */
    body.theme-light {
      --bg: #f5f7fb;
      --card-bg: rgba(255,255,255,0.95);
      --text: #111827;
      --muted: #111827cc;
      --control-bg: #ffffff;
      --accent: #334155;
      --accent-dark: #111827;
      --banner-bg: linear-gradient(90deg,#ffffff,#eef2f7);
    }

    /* Theme: neon */
    body.theme-neon {
      --bg: #04030a;
      --card-bg: rgba(2,0,20,0.6);
      --text: #eaffff;
      --muted: #c0fff7cc;
      --control-bg: #09041a;
      --accent: #00ffd5;
      --accent-dark: #00a3b5;
      --banner-bg: linear-gradient(90deg,#00ffd5,#0ea5e9);
    }

    /* Premium Theme: Galaxy Glow */
    body.theme-galaxy {
      --bg: radial-gradient(circle at 20% 10%, #0b0f2b 0%, #000014 40%, #000 100%);
      --card-bg: linear-gradient(180deg, rgba(10,10,30,0.86), rgba(0,0,0,0.6));
      --text: #dbe9ff;
      --muted: #99b4ffcc;
      --control-bg: rgba(8,10,25,0.8);
      --accent: #7c5cff;
      --accent-dark: #2dd4bf;
      --banner-bg: linear-gradient(90deg,#6d28d9,#3b82f6,#06b6d4);
    }

    /* Premium Theme: Royal Gold */
    body.theme-royal {
      --bg: linear-gradient(180deg,#120800,#1f0f04);
      --card-bg: linear-gradient(180deg, rgba(40,24,6,0.9), rgba(20,12,2,0.8));
      --text: #fff7e6;
      --muted: #ffeb99cc;
      --control-bg: rgba(36,20,6,0.9);
      --accent: #ffd700;
      --accent-dark: #ffb300;
      --banner-bg: linear-gradient(90deg,#b8860b,#ffd700,#f59e0b);
    }
    /* Theme-specific card opacity adjustments */
body.theme-light .card { background: rgba(255,255,255,0.97); }
body.theme-neon .card { background: rgba(2,0,20,0.75); }
body.theme-galaxy .card { background: rgba(10,10,30,0.92); }
body.theme-royal .card { background: rgba(40,24,6,0.95); }

/* Modal background opacity boost for clarity */
body.theme-light .modal { background: rgba(255,255,255,0.97); }
body.theme-neon .modal { background: rgba(2,0,20,0.92); }
body.theme-galaxy .modal { background: rgba(10,10,30,0.95); }
body.theme-royal .modal { background: rgba(40,24,6,0.97); }
    /* Base */
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 18px;
      font-family: var(--font-family);
      background: var(--bg);
      color: var(--text);
      transition: background .35s ease, color .3s ease;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* Promo banner */
    .promo-banner {
      position: fixed;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 60;
      width: min(96%, 560px);
      display: flex;
      gap: 12px;
      align-items: center;
      padding: 10px 12px;
      border-radius: 12px;
      background: var(--banner-bg);
      color: var(--text);
      box-shadow: 0 10px 30px rgba(0,0,0,0.45);
      border: 1px solid rgba(255,255,255,0.04);
      backdrop-filter: blur(6px);
      font-size: 0.95rem;
    }
    .promo-content { flex: 1; text-align: left; }
    .promo-title { font-weight: 700; font-size: 1rem; margin-bottom: 2px; }
    .promo-line { font-size: .86rem; color: var(--muted); margin-bottom: 6px; }
    .promo-price { font-weight: 800; font-size: 0.98rem; }

    .promo-actions { display:flex; gap:8px; align-items:center; }
    .promo-btn {
      border: none;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      background: linear-gradient(90deg,var(--accent),var(--accent-dark));
      color: rgba(0,0,0,0.9);
    }
    .promo-close {
      background: transparent;
      border: none;
      color: var(--muted);
      font-size: 18px;
      cursor: pointer;
      padding: 6px;
    }

    /* Upgrade small button after dismiss */
    #upgradeBtn {
      position: fixed;
      top: 12px;
      right: 12px;
      z-index: 70;
      display: none;
      border: none;
      padding: 8px 12px;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(90deg,var(--accent),var(--accent-dark));
      color: rgba(0,0,0,0.9);
      box-shadow: 0 6px 20px rgba(0,0,0,0.35);
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.55);
      z-index: 120;
    }
    .modal {
      width: min(96%, 520px);
      max-width: 520px;
      background: var(--card-bg);
      padding: 18px;
      border-radius: 12px;
      color: var(--text);
      box-shadow: 0 20px 50px rgba(0,0,0,0.6);
    }
    .modal h2 { margin: 0 0 8px 0; font-size: 1.25rem; }
    .modal p { margin: 6px 0; color: var(--muted); }
    .modal ul { margin: 8px 0 12px 18px; color: var(--muted); }
    .modal .modal-actions { display:flex; gap:8px; justify-content:flex-end; }

    /* Card (main) */
    .card {
      width: 100%;
      max-width: 820px;
      background: var(--card-bg);
      border-radius: 14px;
      padding: 20px;
      box-shadow: 0 12px 48px rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
      border: 1px solid rgba(255,255,255,0.03);
    }

    h1 { margin: 6px 0 6px; font-size: clamp(1.8rem,4vw,2.6rem); text-align:center; }
    label { align-self: flex-start; color: var(--muted); font-weight: 600; }
    .row { width:100%; display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    input[type="text"], select, button {
      padding: 12px 14px;
      border-radius: 10px;
      border: none;
      background: var(--control-bg);
      color: var(--text);
      font-size: 1rem;
      outline: none;
      box-shadow: 0 6px 22px rgba(0,0,0,0.25);
    }
    input[type="text"] { flex:1 1 220px; min-width:160px; }
    select { min-width: 180px; }
    .secondary { background: rgba(255,255,255,0.05); font-weight:700; color:var(--text); }

    /* Progress */
    .progress-container { width: 90%; max-width: 480px; background: rgba(255,255,255,0.04); border-radius: 26px; overflow:hidden; height:22px; display:none; }
    .progress-bar { height:100%; width:0%; background: linear-gradient(90deg,var(--accent),var(--accent-dark)); transition: width .12s linear; }

    #loadingText { color:var(--muted); min-height:28px; font-style: italic; opacity:0; transition: opacity .25s; text-align:center; }

    #result { font-weight:800; text-align:center; font-size:1.05rem; color:var(--text); }

    .small-muted { color:var(--muted); font-size:.9rem; }

    footer { margin-top: 18px; color:var(--muted); font-family:'Playfair Display', serif; font-weight:600; }

    /* Responsive */
    @media (max-width:760px) {
      .promo-banner { left:50%; transform:translateX(-50%); width: calc(100% - 28px); top: 8px; padding:10px; }
      .card { padding: 16px; }
      .row { align-items:stretch; }
      select, button, input[type="text"] { width:100%; }
      #upgradeBtn { top: 8px; right: 8px; padding: 8px 10px; }
    }
  </style>
  <style>html, body { cursor: none; }

.Cursor {
  z-index: 9999;
  pointer-events: none;
  position: fixed;
  top: 0; left: 0;
  filter: url("#goo");
  mix-blend-mode: difference; /* ðŸ‘ˆ put here */
}

.Cursor span {
  position: absolute;
  width: 26px;
  height: 26px;
  border-radius: 50%;
  background: red !important; /* test color */
  transform: translate(-50%, -50%);
  mix-blend-mode: normal !important; /* disable blending test */
}

</style>
</head>
<body>
<svg xmlns="http://www.w3.org/2000/svg">
  <defs>
    <filter id="goo">
      <feGaussianBlur in="SourceGraphic" stdDeviation="8" result="blur"/>
      <feColorMatrix in="blur" mode="matrix"
        values="1 0 0 0 0  
                0 1 0 0 0  
                0 0 1 0 0  
                0 0 0 25 -10" result="goo"/>
      <feComposite in="SourceGraphic" in2="goo" operator="atop"/>
    </filter>
  </defs>
</svg>

<div id="cursor" class="Cursor"></div>

  <!-- Promo Banner (theme-aware background via CSS variables) -->
  <div id="promoBanner" class="promo-banner" role="region" aria-label="Premium promotion" style="display:none;">
    <div class="promo-content">
      <div class="promo-title">Limited Time Premium</div>
      <div class="promo-line">3-day predictions â€¢ Exclusive themes â€¢ Premium sarcasm</div>
      <div class="promo-price">
        <span id="newPrice">â‚¹49.99</span>
        <span class="small-muted" style="margin-left:8px; text-decoration:line-through; opacity:0.85;" id="oldPrice">â‚¹78,754 + 12% GST</span>
        <span style="margin-left:8px; font-weight:800; color: #ffd54f;" id="discountPct">(~99.94% OFF)</span>
      </div>
    </div>

    <div class="promo-actions">
      <button id="buyPremiumBtn" class="promo-btn" aria-label="Buy Premium">Buy â‚¹49.99</button>
      <button id="closePromoBtn" class="promo-close" aria-label="Close promotion">âœ•</button>
    </div>
  </div>

  <!-- Upgrade tiny button appears after closing the banner -->
  <button id="upgradeBtn" title="Upgrade to Premium" aria-haspopup="dialog">Upgrade to Premium</button>

  <!-- Modal -->
  <div id="modalOverlay" class="modal-overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
     <h2 id="modalTitle">Premium Access Package</h2>
<p class="small-muted">Elevate your Tomorrow Day Predictor experience with our carefully curated premium features:</p>
<ul>
  <li>Predict up to <strong>3 days in advance</strong> with scientifically optimized accuracy.</li>
  <li>Exclusive <strong>Galaxy Glow</strong> and <strong>Royal Gold</strong> themes for premium visual experience.</li>
  <li>Advanced typography & custom font settings to match your style.</li>
  <li>Priority support & insightful predictive analytics tailored for premium members.</li>
</ul>
<p><strong>Price:</strong> â‚¹49.99 <span class="small-muted" style="margin-left:8px; text-decoration:line-through;">â‚¹78,754 + 12% GST</span></p>
<p class="small-muted" id="modalDiscount">You receive ~99.94% discount today. Unlock your premium access instantly.</p>
      <div class="modal-actions">
        <button id="modalCancel" class="secondary">Close</button>
        <button id="modalBuy" class="promo-btn">Buy â‚¹49.99</button>
      </div>
    </div>
  </div>

  <h1>Tomorrow Day Predictor</h1>

  <div class="card" role="main" aria-live="polite">
    <label for="yourName">Enter your name (for account)</label>
    <div class="row" style="width:100%;">
      <input id="yourName" type="text" placeholder="Your name" autocomplete="name" />
      <button id="saveNameBtn" class="secondary">Use</button>
    </div>
    <div class="small-muted" id="currentUserInfo">No user selected</div>

    <hr style="width:100%; opacity:0.06; border:none; height:1px; background:rgba(255,255,255,0.03)">

    <label for="today">Select Today's Day:</label>
    <div class="row" style="align-items:center;">
      <select id="today" aria-label="Select today's day">
        <option value="">--Choose a Day--</option>
        <option>Monday</option>
        <option>Tuesday</option>
        <option>Wednesday</option>
        <option>Thursday</option>
        <option>Friday</option>
        <option>Saturday</option>
        <option>Sunday</option>
      </select>

      <select id="daysSelect" title="How many days ahead to predict?">
        <option value="1">1 day (Tomorrow)</option>
        <option value="2">2 days</option>
        <option value="3">3 days (Premium)</option>
      </select>
    </div>

    <div style="width:100%; display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap;">
      <label for="themeSelect" style="margin-right:auto">Theme:</label>
      <select id="themeSelect" style="width:220px;">
        <option value="default">Default (Dark)</option>
        <option value="light">Light (Premium)</option>
        <option value="neon">Neon (Premium)</option>
        <option value="galaxy">Galaxy Glow (Premium)</option>
        <option value="royal">Royal Gold (Premium)</option>
      </select>
    </div>

    <div style="width:100%; display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap;">
      <label for="fontSelect" style="margin-right:auto">Font:</label>
      <select id="fontSelect" style="width:220px;">
        <option value="Roboto, system-ui, -apple-system, 'Segoe UI', sans-serif">Default (Roboto)</option>
        <option value="Poppins, system-ui, -apple-system, 'Segoe UI', sans-serif">Poppins</option>
        <option value="'Pacifico', cursive">Pacifico (fun)</option>
        <option value="'Playfair Display', serif">Playfair (serif)</option>
      </select>
    </div>

    <div class="row" style="width:100%;">
      <button id="predictBtn">Predict</button>
      <button id="cancelBtn" class="secondary" disabled>Cancel</button>
    </div>

    <div class="progress-container" id="progressContainer">
      <div class="progress-bar" id="progressBar"></div>
    </div>

    <div id="loadingText" aria-hidden="true"></div>
    <div id="result" role="status"></div>

    <div style="width:100%; display:flex; gap:10px; justify-content:space-between; margin-top:8px;">
      <div class="small-muted" id="premiumStatus">Premium users: 0</div>
      <div class="small-muted" id="hintText">Buy premium from the banner to unlock features</div>
    </div>
  </div>

  <footer>â€” Aryaman Gupta â€”</footer>

  <script>
    /* ---------------- config & storage ---------------- */
    const STORAGE_KEYS = {
      PREMIUM_USERS: 'tp_premium_users_v1',
      SELECTED_THEME: 'tp_selected_theme_v1',
      CURRENT_USER: 'tp_current_user_v1',
      PROMO_DISMISSED: 'tp_promo_dismissed_v1'
    };

    /* ---------------- promo price calc & display ---------------- */
    const OLD_PRICE_BASE = 78754; // base
    const OLD_PRICE_GST = 0.12; // 12%
    const OLD_PRICE_TOTAL = OLD_PRICE_BASE * (1 + OLD_PRICE_GST); // 88264.48
    const NEW_PRICE = 49.99;

    function formatINR(n) {
      // simple formatting with rupee symbol and 2 decimals
      return 'â‚¹' + Number(n).toLocaleString('en-IN', {maximumFractionDigits:2, minimumFractionDigits: (Number(n)%1===0?0:2)});
    }

    const promoBanner = document.getElementById('promoBanner');
    document.getElementById('newPrice').innerText = formatINR(NEW_PRICE);
    document.getElementById('oldPrice').innerText = `â‚¹${OLD_PRICE_BASE.toLocaleString('en-IN')} + 12% GST`;
    const pctOff = ((OLD_PRICE_TOTAL - NEW_PRICE) / OLD_PRICE_TOTAL) * 100;
    document.getElementById('discountPct').innerText = `(~${pctOff.toFixed(2)}% OFF)`;
    document.getElementById('modalDiscount').innerText = `You get ~${pctOff.toFixed(2)}% OFF. Congrats.`;

    /* ---------------- misc UI elements ---------------- */
    const upgradeBtn = document.getElementById('upgradeBtn');
    const modalOverlay = document.getElementById('modalOverlay');
    const modalCancel = document.getElementById('modalCancel');
    const modalBuy = document.getElementById('modalBuy');

    /* ---------------- remove marquee: (we simply do not include any marquee code) ---------------- */

    /* ---------------- premium users list (read-only client) ---------------- */
    function loadPremiumUsers(){
      try {
        const raw = localStorage.getItem(STORAGE_KEYS.PREMIUM_USERS);
        return raw ? JSON.parse(raw) : [];
      } catch(e){ return []; }
    }

    function updatePremiumStatusUI(){
      const users = loadPremiumUsers();
      document.getElementById('premiumStatus').innerText = `Premium users: ${users.length}`;
    }

    /* ---------------- current user and theme ---------------- */
    function normalizeName(name){ return (name||'').trim(); }
    function saveCurrentUser(name){
      name = normalizeName(name);
      if(!name) localStorage.removeItem(STORAGE_KEYS.CURRENT_USER);
      else localStorage.setItem(STORAGE_KEYS.CURRENT_USER, name);
      updateCurrentUserUI();
    }
    function loadCurrentUser(){ return localStorage.getItem(STORAGE_KEYS.CURRENT_USER) || ''; }
    function isPremium(name){
      name = normalizeName(name);
      if(!name) return false;
      const users = loadPremiumUsers();
      return users.includes(name);
    }

    function updateCurrentUserUI(){
      const name = loadCurrentUser();
      const info = document.getElementById('currentUserInfo');
      if(!name){
        info.innerText = 'No user selected';
        document.getElementById('yourName').value = '';
      } else {
        const premium = isPremium(name);
        info.innerText = `Using name: ${name} ${premium ? 'â€” Premium' : ''}`;
      }
      updateControlsBasedOnPremium();
    }

    function updateControlsBasedOnPremium(){
      const name = loadCurrentUser();
      const daysSelect = document.getElementById('daysSelect');
      const themeSelect = document.getElementById('themeSelect');
      const isP = isPremium(name);
      const opt3 = Array.from(daysSelect.options).find(o => o.value === '3');
      if(opt3) opt3.disabled = !isP;
      Array.from(themeSelect.options).forEach(o=>{
        if(o.value === 'light' || o.value === 'neon' || o.value === 'galaxy' || o.value === 'royal') {
          // premium locked except default
          if(o.value === 'default') o.disabled = false;
          else o.disabled = !isP;
        }
      });
      document.getElementById('hintText').innerText = isP ? 'Premium features unlocked âœ…' : 'Buy premium from the banner to unlock 3-day & themes';
    }

    /* ---------------- theme & font handling ---------------- */
    const themeSelect = document.getElementById('themeSelect');
    const fontSelect = document.getElementById('fontSelect');

    function applyTheme(theme) {
      // cleanup
      document.body.classList.remove('theme-light','theme-neon','theme-galaxy','theme-royal');
      if(theme === 'light') document.body.classList.add('theme-light');
      if(theme === 'neon') document.body.classList.add('theme-neon');
      if(theme === 'galaxy') document.body.classList.add('theme-galaxy');
      if(theme === 'royal') document.body.classList.add('theme-royal');
      localStorage.setItem(STORAGE_KEYS.SELECTED_THEME, theme);
    }

    function loadSavedTheme() {
      const t = localStorage.getItem(STORAGE_KEYS.SELECTED_THEME) || 'default';
      if(themeSelect) themeSelect.value = t;
      applyTheme(t);
    }

    themeSelect.addEventListener('change', (e)=>{
      const sel = e.target.value;
      const current = loadCurrentUser();
      if((sel === 'light' || sel === 'neon' || sel === 'galaxy' || sel === 'royal') && !isPremium(current)){
        alert('That theme is available for premium users only. Purchase to unlock.');
        e.target.value = 'default';
        applyTheme('default');
        return;
      }
      applyTheme(sel);
    });

    fontSelect.addEventListener('change', (e)=>{
      const val = e.target.value;
      document.documentElement.style.setProperty('--font-family', val);
      document.body.style.setProperty('font-family', val);
      localStorage.setItem('tp_selected_font_v1', val);
    });

    // load saved font
    (function(){
      const saved = localStorage.getItem('tp_selected_font_v1');
      if(saved){
        fontSelect.value = saved;
        document.body.style.setProperty('font-family', saved);
      }
    })();

    /* ---------------- promo banner show/hide & upgrade flow ---------------- */
    const PROMO_KEY = STORAGE_KEYS.PROMO_DISMISSED;
    function showPromoIfNeeded(){
      const dismissed = localStorage.getItem(PROMO_KEY) === '1';
      if(!dismissed) promoBanner.style.display = 'flex';
      else {
        promoBanner.style.display = 'none';
        upgradeBtn.style.display = 'block';
      }
    }
    function dismissPromo(){
      localStorage.setItem(PROMO_KEY, '1');
      promoBanner.style.display = 'none';
      upgradeBtn.style.display = 'block';
    }

    // wire promo controls
    document.getElementById('closePromoBtn').addEventListener('click', dismissPromo);
    document.getElementById('buyPremiumBtn').addEventListener('click', ()=>{
      alert('Buy flow placeholder: integrate server-side order/create payment link here.');
    });

    // upgrade button opens modal
    upgradeBtn.addEventListener('click', ()=>{
      modalOverlay.style.display = 'flex';
      modalOverlay.setAttribute('aria-hidden', 'false');
    });

    modalCancel.addEventListener('click', ()=>{
      modalOverlay.style.display = 'none';
      modalOverlay.setAttribute('aria-hidden', 'true');
    });
    modalBuy.addEventListener('click', ()=>{
      alert('Buy flow placeholder: integrate server-side order/create payment link here.');
    });

    /* ---------------- core prediction logic (single-click + cancel + 2s cooldown) ---------------- */
    const predictBtn = document.getElementById('predictBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const loadingText = document.getElementById('loadingText');
    const resultEl = document.getElementById('result');

    const funnyLines = [
      "Consulting alien octopi about Tuesday blues...",
      "Uploading sarcasm directly into Jupiterâ€™s rings...",
      "Training neon llamas to run the stock market...",
      "Convincing black holes to share their secrets...",
      "Hiring AI squirrels to debug the multiverse...",
      "Brewing coffee inside a collapsing star...",
      "Teaching quantum cats to solve equations...",
      "Negotiating peace between two rival dimensions...",
      "Encrypting your bad vibes into 12D space...",
      "Installing happiness.exe in parallel realities..."
    ];

    let predictRunning = false;
    let progressInterval = null;
    let lineInterval = null;
    let finalTimeout = null;
    const DURATION_MS = 8000;

    function resetProgressUI(){
      if(progressInterval){ clearInterval(progressInterval); progressInterval = null; }
      if(lineInterval){ clearInterval(lineInterval); lineInterval = null; }
      if(finalTimeout){ clearTimeout(finalTimeout); finalTimeout = null; }
      if(progressBar) progressBar.style.width = '0%';
      if(progressContainer) progressContainer.style.display = 'none';
      if(loadingText) { loadingText.style.opacity = 0; loadingText.innerText = ''; }
    }

    cancelBtn.addEventListener('click', ()=>{
      if(!predictRunning) return;
      resetProgressUI();
      predictRunning = false;
      resultEl.innerHTML = "âŒ Prediction cancelled.";
      cancelBtn.disabled = true;
      predictBtn.disabled = true;
      setTimeout(()=>{
        predictBtn.disabled = false;
        cancelBtn.disabled = true;
        resultEl.innerHTML = '';
      }, 2000);
    });

    function predictTomorrow(){
      if(predictRunning) return;
      predictRunning = true;
      predictBtn.disabled = true;
      cancelBtn.disabled = false;
      resultEl.innerHTML = '';

      const today = document.getElementById('today').value;
      const daysAhead = parseInt(document.getElementById('daysSelect').value || '1', 10);
      const currentUser = loadCurrentUser();

      if(!currentUser){
        alert('Please enter your name first (so we can check premium).');
        predictRunning = false;
        predictBtn.disabled = false;
        cancelBtn.disabled = true;
        return;
      }
      if(!today){
        resultEl.innerHTML = "âš ï¸ Please select today's day!";
        predictRunning = false;
        predictBtn.disabled = false;
        cancelBtn.disabled = true;
        return;
      }
      if(daysAhead > 2 && !isPremium(currentUser)){
        alert('3-day prediction is for premium users only. Buy premium to use this.');
        predictRunning = false;
        predictBtn.disabled = false;
        cancelBtn.disabled = true;
        return;
      }

      // show progress UI
      progressContainer.style.display = 'block';
      progressBar.style.width = '0%';
      loadingText.style.opacity = 1;

      // pick lines
      const selected = [];
      while(selected.length < 4){
        const l = funnyLines[Math.floor(Math.random()*funnyLines.length)];
        if(!selected.includes(l)) selected.push(l);
      }
      let li = 0;
      loadingText.innerText = selected[li++];
      lineInterval = setInterval(()=>{
        if(li >= selected.length) li = 0;
        loadingText.innerText = selected[li++];
      }, 2000);

      const start = Date.now();
      progressInterval = setInterval(()=>{
        const elapsed = Date.now() - start;
        const pct = Math.min(100, (elapsed / DURATION_MS) * 100);
        progressBar.style.width = pct + '%';
        if(pct >= 100){
          clearInterval(progressInterval);
          progressInterval = null;
        }
      }, 100);

      finalTimeout = setTimeout(()=>{
        resetProgressUI();
        const days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
        const index = days.indexOf(today);
        const outputs = [];
        for(let k=1;k<=daysAhead;k++){
          outputs.push({n:k, day: days[(index + k) % 7]});
        }
        let html = '';
        outputs.forEach(o=>{
          if(o.n === 1) html += `Tomorrow is <span style="color:var(--text);">${o.day}</span><br/>`;
          else html += `In ${o.n} days: <span style="color:var(--text);">${o.day}</span><br/>`;
        });
        if(isPremium(currentUser)){
          html += `<div style="margin-top:8px; font-size:0.9rem; color:var(--muted)">You're a premium user âœ…</div>`;
        } else {
          html += `<div style="margin-top:8px; font-size:0.9rem; color:var(--muted)">Buy premium for 3-day predictions & themes</div>`;
        }
        resultEl.innerHTML = html;
        predictRunning = false;
        predictBtn.disabled = false;
        cancelBtn.disabled = true;
      }, DURATION_MS + 100);
    }

    predictBtn.addEventListener('click', predictTomorrow);

    /* ---------------- init UI state on load ---------------- */
    document.getElementById('saveNameBtn').addEventListener('click', ()=>{
      const name = document.getElementById('yourName').value;
      if(!name.trim()){ alert('Please enter your name to continue.'); return; }
      saveCurrentUser(name.trim());
    });

    // watch storage changes (premium list update)
    window.addEventListener('storage', (e)=>{
      if(e.key === STORAGE_KEYS.PREMIUM_USERS) updatePremiumStatusUI();
      if(e.key === STORAGE_KEYS.CURRENT_USER) updateCurrentUserUI();
    });

    function resetAllStateOnLoad(){
      predictBtn.disabled = false;
      cancelBtn.disabled = true;
      predictRunning = false;
      resetProgressUI();
    }

    // initial calls
    loadSavedTheme();
    updatePremiumStatusUI();
    updateCurrentUserUI();
    showPromoIfNeeded();
    resetAllStateOnLoad();

    // accessibility: close modal on ESC
    window.addEventListener('keydown', (e) => {
      if(e.key === 'Escape'){
        modalOverlay.style.display = 'none';
        modalOverlay.setAttribute('aria-hidden', 'true');
      }
    });
  </script>

<!-- Background canvas (behind the UI card) -->
<canvas id="bgCanvas" style="position:fixed;inset:0;z-index:10;pointer-events:none;opacity:0.42;transition:opacity .25s linear;"></canvas>
<script>

  /* ---------- Background Animations (modular, simplified but pretty) ---------- */

  /* Neon: drifting nebula particles (soft blurred blobs) */
  function neonNebula(){
    const blobs = [];
    const maxBlobs = 28;
    for(let i=0;i<maxBlobs;i++){
      blobs.push({
        x: rand(0,bgW), y: rand(0,bgH),
        vx: rand(-0.12,0.12), vy: rand(-0.08,0.08),
        r: rand(60,220),
        hue: rand(150,200),
        alpha: rand(0.06,0.22)
      });
    }
    function draw(){
      bgCtx.clearRect(0,0,bgW,bgH);
      // soft background base
      bgCtx.fillStyle = 'rgba(3,3,8,0.12)'; bgCtx.fillRect(0,0,bgW,bgH);
      // nebula blobs
      for(const b of blobs){
        b.x += b.vx; b.y += b.vy;
        if(b.x < -b.r) b.x = bgW + b.r;
        if(b.x > bgW + b.r) b.x = -b.r;
        if(b.y < -b.r) b.y = bgH + b.r;
        if(b.y > bgH + b.r) b.y = -b.r;
        // radial gradient
        const g = bgCtx.createRadialGradient(b.x, b.y, b.r*0.05, b.x, b.y, b.r);
        g.addColorStop(0, `hsla(${b.hue},95%,64%,${b.alpha})`);
        g.addColorStop(0.35, `hsla(${b.hue},80%,48%,${b.alpha*0.7})`);
        g.addColorStop(1, `rgba(0,0,0,0)`);
        bgCtx.globalCompositeOperation = 'lighter';
        bgCtx.fillStyle = g;
        bgCtx.beginPath();
        bgCtx.arc(b.x, b.y, b.r, 0, Math.PI*2);
        bgCtx.fill();
        bgCtx.globalCompositeOperation = 'source-over';
      }
      bgAnimId = requestAnimationFrame(draw);
    }
    draw();
  }

  /* Galaxy: twinkling stars + faint comet streaks */
  function galaxySky(){
    const stars = [];
    for(let i=0;i<260;i++){
      stars.push({ x: rand(0,bgW), y: rand(0,bgH), s: rand(0.3,1.6), alpha: rand(0.05,0.95), twinkle: Math.random()*2000 });
    }
    const comets = [];
    function maybeSpawnComet(){
      if(Math.random() < 0.012){
        const fromX = rand(0,bgW*0.6), fromY = rand(0,bgH*0.2);
        comets.push({ x: fromX, y: fromY, vx: rand(2.5,6.5), vy: rand(0.4,1.8), life: 0, maxLife: rand(120,260) });
      }
    }
    function draw(){
      bgCtx.clearRect(0,0,bgW,bgH);
      // deep background
      bgCtx.fillStyle = 'rgba(2,4,12,0.18)'; bgCtx.fillRect(0,0,bgW,bgH);

      // stars
      for(const s of stars){
        s.alpha = 0.5 + 0.5 * Math.sin((Date.now()/1000) + s.twinkle);
        bgCtx.beginPath();
        bgCtx.globalAlpha = s.alpha * 0.95;
        bgCtx.fillStyle = 'rgba(220,235,255,1)';
        bgCtx.arc(s.x, s.y, s.s, 0, Math.PI*2);
        bgCtx.fill();
        bgCtx.globalAlpha = 1;
      }

      // comets
      if(comets.length < 3 && Math.random() < 0.015) maybeSpawnComet();
      for(let i=comets.length-1;i>=0;i--){
        const c = comets[i];
        // trail
        bgCtx.beginPath();
        const tailLen = Math.min(200, c.life*2 + 30);
        bgCtx.strokeStyle = `rgba(210,240,255,${Math.max(0, 0.5 - (c.life / c.maxLife))})`;
        bgCtx.lineWidth = 1.6;
        bgCtx.moveTo(c.x, c.y);
        bgCtx.lineTo(c.x - c.vx*tailLen*0.5, c.y - c.vy*tailLen*0.5);
        bgCtx.stroke();
        // head
        bgCtx.beginPath();
        bgCtx.fillStyle = `rgba(235,245,255,${Math.max(0, 0.9 - (c.life / c.maxLife))})`;
        bgCtx.arc(c.x, c.y, 1.8 + (c.life*0.005), 0, Math.PI*2);
        bgCtx.fill();
        // update
        c.x += c.vx; c.y += c.vy; c.life++;
        if(c.life > c.maxLife || c.x > bgW + 100 || c.y > bgH + 100) comets.splice(i,1);
      }

      bgAnimId = requestAnimationFrame(draw);
    }
    draw();
  }

  /* Royal: liquid gold wave effect */
  function royalLiquid(){
    // create a few sine-wave layers
    const waves = [];
    for(let i=0;i<4;i++){
      waves.push({ amp: rand(18,62) * (i+1), speed: rand(0.0006,0.0020)*(i+1), phase: rand(0,Math.PI*2), hueShift: rand(-10,10), yBase: bgH * (0.3 + i*0.12) });
    }
    function draw(){
      bgCtx.clearRect(0,0,bgW,bgH);
      bgCtx.fillStyle = 'rgba(6,4,2,0.18)'; bgCtx.fillRect(0,0,bgW,bgH);
      // layered waves
      waves.forEach((w, idx)=>{
        bgCtx.beginPath();
        bgCtx.moveTo(0, bgH);
        for(let x = 0; x <= bgW; x += 18){
          const y = w.yBase + Math.sin((x * 0.006) + (Date.now()*w.speed) + w.phase) * w.amp;
          bgCtx.lineTo(x, y);
        }
        bgCtx.lineTo(bgW, bgH);
        bgCtx.closePath();
        // gradient gold
        const g = bgCtx.createLinearGradient(0, w.yBase - 120, 0, w.yBase + 120);
        g.addColorStop(0, `rgba(${255},${215},${79},${0.08 + idx*0.04})`);
        g.addColorStop(0.5, `rgba(${255},${226},${120},${0.06 + idx*0.03})`);
        g.addColorStop(1, `rgba(0,0,0,0)`);
        bgCtx.fillStyle = g;
        bgCtx.fill();
      });
      bgAnimId = requestAnimationFrame(draw);
    }
    draw();
  }

  /* Light: soft gradient pulse */
  function lightPulse(){
    function draw(){
      bgCtx.clearRect(0,0,bgW,bgH);
      // soft base
      const t = Date.now() / 1800;
      const g = bgCtx.createLinearGradient(0, 0, bgW, bgH);
      const a = 0.18 + 0.06 * Math.sin(t);
      g.addColorStop(0, `rgba(230,238,255,${a})`);
      g.addColorStop(1, `rgba(240,246,255,${a*0.6})`);
      bgCtx.fillStyle = g;
      bgCtx.fillRect(0,0,bgW,bgH);

      // faint circular pulse at cursor
      bgCtx.beginPath();
      const cr = 160 + 40 * Math.sin(t*1.2);
      const cx = cursor.x || (bgW/2), cy = cursor.y || (bgH/2);
      const rg = bgCtx.createRadialGradient(cx, cy, cr*0.02, cx, cy, cr);
      rg.addColorStop(0, `rgba(255,255,255,${0.06})`);
      rg.addColorStop(1, `rgba(255,255,255,0)`);
      bgCtx.fillStyle = rg;
      bgCtx.arc(cx, cy, cr, 0, Math.PI*2);
      bgCtx.fill();

      bgAnimId = requestAnimationFrame(draw);
    }
    draw();
  }

  /* Default: subtle noise / vignette */
  function defaultSubtle(){
    function draw(){
      bgCtx.clearRect(0,0,bgW,bgH);
      bgCtx.fillStyle = 'rgba(10,10,12,0.12)';
      bgCtx.fillRect(0,0,bgW,bgH);
      // very soft vignette using radial gradient
      const vg = bgCtx.createRadialGradient(bgW/2, bgH/2, Math.min(bgW,bgH)*0.25, bgW/2, bgH/2, Math.max(bgW,bgH));
      vg.addColorStop(0, 'rgba(255,255,255,0)');
      vg.addColorStop(1, 'rgba(0,0,0,0.24)');
      bgCtx.fillStyle = vg;
      bgCtx.fillRect(0,0,bgW,bgH);
      bgAnimId = requestAnimationFrame(draw);
    }
    draw();
  }

  /* ---------- Hook into theme changes so background updates live ---------- */
  const themeSelect = document.getElementById('themeSelect');
  if(themeSelect){
    // call initParticles immediately for current theme
    initParticles(currentTheme());
    // ensure your existing event still runs (it does) â€” we only attach another listener
    themeSelect.addEventListener('change', (e)=>{
      // Respect premium gating: if the themeSelect was reverted by original handler due to premium lock,
      // call initParticles on the body-derived theme.
      setTimeout(()=> initParticles(currentTheme()), 40);
    });
  } else {
    // fallback
    initParticles(currentTheme());
  }

  /* ---------- Ensure cursor <-> background subtle interactions ---------- */
  // Small subtle effect: when cursor is near, add a faint glow or local distortion to bg for each theme.
  function backgroundCursorInteraction(){
    // We'll add a soft radial overlay at cursor that reacts slightly based on theme.
    if(!bgCtx) return;
    // We piggyback onto the existing background animation frames by drawing overlay last.
    // To keep it simple, we won't inject into each theme's draw loop, but expose a small overlay loop.
    function loop(){
      // lightweight overlay: draw translucent radial at cursor
      // We'll composite on top and then restore (but keep low alpha)
      const theme = currentTheme();
      const cx = cursor.x || (bgW/2), cy = cursor.y || (bgH/2);
      const r = Math.min(bgW, bgH) * (theme === 'light' ? 0.18 : 0.12);
      const overlay = bgCtx.createRadialGradient(cx, cy, r*0.02, cx, cy, r);
      if(theme === 'neon') {
        overlay.addColorStop(0, 'rgba(0,255,213,0.08)');
        overlay.addColorStop(1, 'rgba(0,0,0,0)');
        bgCtx.globalCompositeOperation = 'lighter';
      } else if(theme === 'galaxy'){
        overlay.addColorStop(0, 'rgba(219,233,255,0.06)');
        overlay.addColorStop(1, 'rgba(0,0,0,0)');
        bgCtx.globalCompositeOperation = 'lighter';
      } else if(theme === 'royal'){
        overlay.addColorStop(0, 'rgba(255,213,79,0.06)');
        overlay.addColorStop(1, 'rgba(0,0,0,0)');
        bgCtx.globalCompositeOperation = 'soft-light';
      } else {
        overlay.addColorStop(0, 'rgba(255,255,255,0.04)');
        overlay.addColorStop(1, 'rgba(0,0,0,0)');
        bgCtx.globalCompositeOperation = 'overlay';
      }
      bgCtx.fillStyle = overlay;
      bgCtx.beginPath();
      bgCtx.arc(cx, cy, r, 0, Math.PI*2);
      bgCtx.fill();
      bgCtx.globalCompositeOperation = 'source-over';
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);
  }
  backgroundCursorInteraction();

  /* ---------- Font list: populate #fontSelect with 20+ fonts, load them ---------- */
  (function expandFontList(){
    const fontSelect = document.getElementById('fontSelect');
    if(!fontSelect) return;
    // list of font family strings (value is CSS font-family fallback).
    const fonts = [
      {name:'Roboto', val:"Roboto, system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'Poppins', val:"Poppins, system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'Inter', val:"Inter, system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'Montserrat', val:"Montserrat, system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'Lato', val:"Lato, system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'Open Sans', val:"'Open Sans', system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'Raleway', val:"Raleway, system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'Nunito', val:"Nunito, system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'Merriweather', val:"'Merriweather', serif"},
      {name:'Playfair Display', val:"'Playfair Display', serif"},
      {name:'Pacifico', val:"'Pacifico', cursive"},
      {name:'Oswald', val:"Oswald, system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'Ubuntu', val:"Ubuntu, system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'Fira Sans', val:"'Fira Sans', system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'Josefin Sans', val:"'Josefin Sans', system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'Quicksand', val:"Quicksand, system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'Karla', val:"Karla, system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'Inconsolata', val:"Inconsolata, monospace"},
      {name:'Cabin', val:"Cabin, system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'DM Sans', val:"'DM Sans', system-ui, -apple-system, 'Segoe UI', sans-serif"},
      {name:'Alegreya', val:"'Alegreya', serif"},
      {name:'Noto Sans', val:"'Noto Sans', system-ui, -apple-system, 'Segoe UI', sans-serif"}
    ];

    // Overwrite existing options but keep an accessible default placeholder
    fontSelect.innerHTML = '';
    fonts.forEach(f=>{
      const opt = document.createElement('option');
      opt.value = f.val;
      opt.textContent = f.name;
      fontSelect.appendChild(opt);
    });

    // Load Google fonts stylesheet for the chosen fonts (best-effort single URL)
    const googleFamilies = fonts.map(f => encodeURIComponent(f.name.replace(/ /g,'+'))).join('|');
    const gfLink = document.createElement('link');
    gfLink.rel = 'stylesheet';
    gfLink.href = `https://fonts.googleapis.com/css2?family=${googleFamilies}&display=swap`;
    document.head.appendChild(gfLink);

    // restore saved font if present (your existing code also uses tp_selected_font_v1)
    const saved = localStorage.getItem(STORAGE.SELECTED_FONT);
    if(saved){
      fontSelect.value = saved;
      document.documentElement.style.setProperty('--font-family', saved);
      document.body.style.setProperty('font-family', saved);
    }

    // maintain existing change behavior + persist via your key
    fontSelect.addEventListener('change', (e)=>{
      const val = e.target.value;
      document.documentElement.style.setProperty('--font-family', val);
      document.body.style.setProperty('font-family', val);
      localStorage.setItem(STORAGE.SELECTED_FONT, val);
    });
  })();

  /* ---------- Premium modal copy update (professional) ---------- */
  (function updateModalCopy(){
    const modalTitle = document.getElementById('modalTitle');
    const modalOverlay = document.getElementById('modalOverlay');
    if(!modalTitle || !modalOverlay) return;
    // Build professional copy
    const modalContent = `
      <h2 id="modalTitle">Premium Access Package</h2>
      <p class="small-muted">Upgrade for an elevated Tomorrow Day Predictor experience crafted for professionals and enthusiasts.</p>
      <ul>
        <li><strong>3-day predictions</strong> with the same intuitive UI and priority access to future features.</li>
        <li><strong>Exclusive visual themes:</strong> Galaxy Glow and Royal Gold with finely-tuned background animations.</li>
        <li><strong>Cursor animations:</strong> subtle, theme-aware cursor FX to increase delight without distraction.</li>
        <li><strong>20+ premium fonts:</strong> choose from an expanded font set and save your preference.</li>
        <li><strong>Priority support & analytics:</strong> dedicated feedback channel and enhanced insights for power users.</li>
      </ul>
      <p><strong>Price:</strong> â‚¹49.99 <span class="small-muted" style="margin-left:8px; text-decoration:line-through;">â‚¹78,754 + 12% GST</span></p>
      <p class="small-muted" id="modalDiscount">You receive the promotional rate today. Unlock instantly.</p>
      <div class="modal-actions">
        <button id="modalCancel" class="secondary">Close</button>
        <button id="modalBuy" class="promo-btn">Buy â‚¹49.99</button>
      </div>
    `;
    // replace inner modal HTML while preserving id attributes used elsewhere
    const modal = modalOverlay.querySelector('.modal');
    if(modal) modal.innerHTML = modalContent;
    // Rewire modal buttons (they existed before; if not, these are safe no-ops)
    const modalCancel = document.getElementById('modalCancel');
    if(modalCancel) modalCancel.addEventListener('click', ()=>{ modalOverlay.style.display = 'none'; modalOverlay.setAttribute('aria-hidden','true'); });
    const modalBuy = document.getElementById('modalBuy');
    if(modalBuy) modalBuy.addEventListener('click', ()=>{ alert('Buy flow placeholder: integrate server-side order/create payment link here.'); });
  })();

  /* ---------- Boot: ensure background is initialized and cursor state set ---------- */
  // call once (safe to call multiple times)
  setTimeout(()=> initParticles(currentTheme()), 30);

  // ensure cursor anim respects saved toggle
  if(cursorEnabled) startCursorAnim(); else stopCursorAnim();

  /* ---------- Clean up on page unload (optional) ---------- */
  window.addEventListener('beforeunload', ()=> {
    if(bgAnimId) cancelAnimationFrame(bgAnimId);
    if(cursorAnimId) cancelAnimationFrame(cursorAnimId);
  });

  })();
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/gsap.min.js"></script>
<script>
const cursor = document.getElementById("cursor");
const amount = 20;
const sineDots = Math.floor(amount * 0.3);
const width = 26;
let mousePosition = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
let dots = [];

class Dot {
    constructor(index = 0) {
        this.index = index;
        this.anglespeed = 0.05;
        this.x = mousePosition.x;
        this.y = mousePosition.y;
        this.scale = 1 - 0.05 * index;
        this.range = width / 2 - width / 2 * this.scale + 2;
        this.lockX = this.x;
        this.lockY = this.y;
        this.angleX = Math.random() * Math.PI * 2;
        this.angleY = Math.random() * Math.PI * 2;

        this.element = document.createElement("span");
        gsap.set(this.element, { scale: this.scale });
        cursor.appendChild(this.element);
    }

    draw(idle) {
        if (idle && this.index > sineDots) {
            this.angleX += this.anglespeed;
            this.angleY += this.anglespeed;
            this.x = this.lockX + Math.sin(this.angleX) * this.range;
            this.y = this.lockY + Math.sin(this.angleY) * this.range;
        } else {
            this.lockX = this.x;
            this.lockY = this.y;
        }
        gsap.set(this.element, { x: this.x, y: this.y });
    }
}

let idle = false;
let timeoutID;
const idleTimeout = 150;

function startIdleTimer() {
    clearTimeout(timeoutID);
    timeoutID = setTimeout(() => (idle = true), idleTimeout);
    idle = false;
}

function onMove(x, y) {
    mousePosition.x = x - width / 2;
    mousePosition.y = y - width / 2;
    startIdleTimer();
    idle = false;
}

function buildDots() {
    for (let i = 0; i < amount; i++) {
        dots.push(new Dot(i));
    }
}

function render() {
    let x = mousePosition.x;
    let y = mousePosition.y;

    dots.forEach((dot, index) => {
        let nextDot = dots[index + 1] || dots[0];
        dot.x = x;
        dot.y = y;
        dot.draw(idle);

        const dx = (nextDot.x - dot.x) * 0.35;
        const dy = (nextDot.y - dot.y) * 0.35;
        x += dx;
        y += dy;
    });

    requestAnimationFrame(render);
}

window.addEventListener("mousemove", e => onMove(e.clientX, e.clientY));
window.addEventListener("touchmove", e => {
    onMove(e.touches[0].clientX, e.touches[0].clientY);
});

buildDots();
  console.log("Cursor spans created:", cursor.children.length);
render();
startIdleTimer();
</script>

</body>
</html>
