<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tomorrow Day Predictor</title>

  <!-- Stylish fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0a0a0a;
      --card-bg: rgba(0,0,0,0.5);
      --text:#ffffff;
      --muted: #ffffffcc;
      --control-bg:#1a1a1a;
      --accent: #ffffffaa;
      --accent-dark: #ffffff55;
    }

    /* Theme: light */
    body.theme-light {
      --bg: #f5f7fb;
      --card-bg: rgba(255,255,255,0.95);
      --text: #111827;
      --muted: #111827cc;
      --control-bg:#fff;
      --accent: #111827aa;
      --accent-dark: rgba(0,0,0,0.06);
    }

    /* Theme: neon */
    body.theme-neon {
      --bg: #04030a;
      --card-bg: rgba(2,0,20,0.6);
      --text: #eaffff;
      --muted: #c0fff7cc;
      --control-bg:#09041a;
      --accent: #00ffd5aa;
      --accent-dark: rgba(0,255,213,0.12);
    }

    /* ------------------- Base & Body ------------------- */
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      text-align: center;
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      overflow-x: hidden;
      position: relative;
      background: var(--bg);
    }

    canvas#bgCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      mix-blend-mode: screen;
    }

    /* ------------------- Small promo banner (professional) ------------------- */
    .promo-banner {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 50;
      width: min(92%, 460px); /* not too wide so it doesn't look like an ad */
      background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border-radius: 12px;
      padding: 10px 12px;
      display: flex;
      gap: 10px;
      align-items: center;
      box-shadow: 0 6px 30px rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.06);
      backdrop-filter: blur(6px);
      font-size: 0.95rem;
      color: var(--text);
    }

    .promo-content {
      flex: 1;
      text-align: left;
    }

    .promo-title {
      font-weight: 700;
      font-size: 1rem;
      margin-bottom: 4px;
    }

    .promo-line {
      font-size: 0.86rem;
      color: var(--muted);
    }

    .promo-price {
      margin-top: 6px;
      font-weight: 700;
      font-size: 0.98rem;
      color: var(--text);
    }

    .promo-actions {
      display:flex;
      gap:8px;
      align-items:center;
    }

    .promo-btn {
      background: linear-gradient(90deg,var(--accent),var(--accent-dark));
      color: #000;
      padding: 8px 10px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      border: none;
    }

    .promo-close {
      background: transparent;
      border: none;
      color: var(--muted);
      font-size: 18px;
      cursor: pointer;
      padding: 6px;
      line-height: 1;
    }

    /* ------------------- Title ------------------- */
    h1 {
      font-size: clamp(2rem, 5vw, 3rem);
      margin-bottom: 30px;
      color: var(--text);
      letter-spacing: 1px;
      text-shadow: 0 0 8px #fff;
    }

    /* ------------------- Card ------------------- */
    .card {
      background: var(--card-bg);
      backdrop-filter: blur(15px);
      border-radius: 18px;
      padding: 22px;
      box-shadow: 0 8px 40px rgba(0,0,0,0.7);
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 720px;
      border: 1px solid rgba(255,255,255,0.06);
      gap: 8px;
    }

    /* ------------------- Labels & Inputs ------------------- */
    label {
      font-size: clamp(1rem, 2vw, 1.05rem);
      margin-bottom: 6px;
      color: var(--muted);
      font-weight: 500;
      align-self: flex-start;
    }

    .row {
      width: 100%;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
    }

    input[type="text"], select, button {
      padding: 12px 16px;
      font-size: clamp(0.95rem, 2vw, 1.05rem);
      border-radius: 12px;
      border: none;
      margin: 6px 0;
      outline: none;
      background: var(--control-bg);
      color: var(--text);
      box-shadow: 0 4px 20px rgba(0,0,0,0.25);
      transition: 0.25s ease;
    }

    /* larger touch targets on small screens */
    @media (max-width: 480px) {
      input[type="text"], select, button {
        padding: 14px 18px;
        min-height: 44px;
      }
      .promo-banner { top: 8px; width: min(94%, 420px); }
    }

    select:focus, input[type="text"]:focus {
      box-shadow: 0 0 10px rgba(255,255,255,0.08), 0 0 18px var(--accent);
    }

    button {
      background: linear-gradient(90deg, var(--accent) 0%, rgba(255,255,255,0.2) 100%);
      cursor: pointer;
      font-weight: bold;
      letter-spacing: 0.5px;
      color: #000;
      border-radius: 12px;
    }

    button.secondary {
      background: rgba(255,255,255,0.06);
      color: var(--text);
      box-shadow: none;
      font-weight:600;
    }

    button[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* ------------------- Progress Bar ------------------- */
    .progress-container {
      width: 90%;
      max-width: 400px;
      background: rgba(255,255,255,0.06);
      border-radius: 25px;
      overflow: hidden;
      margin-top: 12px;
      height: 22px;
      display: none;
      position: relative;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), rgba(255,255,255,0.18));
      box-shadow: 0 0 15px rgba(255,255,255,0.06);
      animation: progressAnim 8s linear forwards;
      position: relative;
      overflow: hidden;
    }

    .progress-bar::before {
      content: '';
      position: absolute;
      top: 0; left: -50%;
      width: 50%;
      height: 100%;
      background: rgba(255,255,255,0.08);
      transform: skewX(-20deg);
      animation: shine 1.5s linear infinite;
    }

    @keyframes progressAnim { from { width:0%; } to { width:100%; } }
    @keyframes shine { 0% { left:-50%; } 100% { left:100%; } }

    /* ------------------- Loading Text ------------------- */
    #loadingText {
      margin-top: 15px;
      font-size: clamp(0.95rem, 2.5vw, 1.1rem);
      font-style: italic;
      color: var(--muted);
      min-height: 28px;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    /* ------------------- Result ------------------- */
    #result {
      margin-top: 18px;
      font-size: clamp(1.05rem, 3vw, 1.2rem);
      font-weight: bold;
      animation: fadeIn 0.8s ease-in;
      color: var(--text);
      text-shadow: 0 2px 15px rgba(255,255,255,0.06);
      word-break: break-word;
    }

    .small-muted {
      font-size: 0.85rem;
      color: var(--muted);
    }

    @keyframes fadeIn {
      from { opacity:0; transform: translateY(6px); }
      to { opacity:1; transform: translateY(0); }
    }

    footer {
      position: absolute;
      bottom: 10px;
      font-size: clamp(0.9rem, 2vw, 1.2rem);
      font-family: 'Playfair Display', serif;
      color: var(--text);
      letter-spacing: 1px;
      font-weight: 600;
      animation: floaty 4s ease-in-out infinite alternate;
    }

    @keyframes floaty { 0%{transform:translateY(0);} 100%{transform:translateY(-6px);} }

    /* marquee */
    .premium-marquee {
      position: fixed;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      width: min(92%, 720px);
      background: rgba(0,0,0,0.28);
      color: var(--text);
      border-radius: 10px;
      padding: 6px 10px;
      display: none;
      gap: 12px;
      z-index: 20;
      font-size: 0.95rem;
      overflow: hidden;
    }
    .marquee-track {
      white-space: nowrap;
      display: inline-block;
      animation: marquee 18s linear infinite;
      direction: rtl;
    }
    @keyframes marquee {
      0% { transform: translateX(0%); }
      100% { transform: translateX(-50%); }
    }

    /* reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .marquee-track, .progress-bar, #loadingText, canvas#bgCanvas {
        animation: none !important;
      }
    }

    /* responsive tweaks */
    @media (max-width: 760px) {
      select, button, input[type="text"] { width: 100%; }
      .card { padding: 16px; }
      h1 { margin-top: 28px; }
      .premium-marquee { top: 120px; font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <canvas id="bgCanvas" aria-hidden="true"></canvas>

  <!-- Promotional professional banner (dismissable) -->
  <div id="promoBanner" class="promo-banner" style="display:none;" role="region" aria-label="Premium promotion">
    <div class="promo-content">
      <div class="promo-title">Limited Time Premium — Unlock advanced features</div>
      <div class="promo-line">3-day predictions • Exclusive themes • Premium badge & referral</div>
      <div class="promo-price">Now ₹51 <span class="small-muted" style="margin-left:8px; text-decoration:line-through; opacity:0.8;">₹78,936.97</span> <span style="color:#ffd54f; margin-left:8px; font-weight:700;">~99.94% OFF</span></div>
    </div>

    <div class="promo-actions" aria-hidden="false">
      <button id="buyPremiumBtn" class="promo-btn" aria-label="Buy Premium">Buy ₹51</button>
      <button id="closePromoBtn" class="promo-close" aria-label="Close promotion">✕</button>
    </div>
  </div>

  <!-- Premium names marquee (if any) -->
  <div class="premium-marquee" id="premiumMarquee" aria-hidden="true">
    <div class="premium-pill" style="display:none;">Premium</div>
    <div id="marqueeTrack" class="marquee-track" aria-hidden="true"></div>
  </div>

  <h1>Tomorrow Day Predictor</h1>

  <div class="card" role="main">
    <label for="yourName">Enter your name (for account)</label>
    <div class="row" style="width:100%;">
      <input id="yourName" type="text" placeholder="Your name" autocomplete="name" />
      <button id="saveNameBtn" class="secondary">Use</button>
    </div>
    <div class="small-muted" id="currentUserInfo">No user selected</div>

    <hr style="width:100%; opacity:0.06; border: none; height:1px; margin:12px 0; background:rgba(255,255,255,0.03)">

    <label for="today">Select Today's Day:</label>
    <div class="row" style="align-items:center;">
      <select id="today" aria-label="Select today's day">
        <option value="">--Choose a Day--</option>
        <option>Monday</option>
        <option>Tuesday</option>
        <option>Wednesday</option>
        <option>Thursday</option>
        <option>Friday</option>
        <option>Saturday</option>
        <option>Sunday</option>
      </select>

      <!-- Days selector: 1,2,3 days. 3-day only for premium users -->
      <select id="daysSelect" title="How many days ahead to predict?">
        <option value="1">1 day (Tomorrow)</option>
        <option value="2">2 days</option>
        <option value="3">3 days (Premium)</option>
      </select>
    </div>

    <!-- Theme selector (premium themes locked until server-verified) -->
    <div style="width:100%; display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap;">
      <label for="themeSelect" style="margin-right:auto">Theme:</label>
      <select id="themeSelect" style="width:200px;">
        <option value="default">Default (Dark)</option>
        <option value="light">Light (Premium)</option>
        <option value="neon">Neon (Premium)</option>
      </select>
    </div>

    <div class="row" style="width:100%;">
      <button onclick="predictTomorrow()" id="predictBtn">Predict</button>
      <!-- no client-side "activate premium" UI to prevent bypass; purchase through Buy button -->
    </div>

    <div class="progress-container" id="progressContainer">
      <div class="progress-bar" id="progressBar"></div>
    </div>

    <div id="loadingText"></div>
    <div id="result"></div>

    <div style="width:100%; display:flex; gap:10px; justify-content:space-between; margin-top:8px;">
      <div class="small-muted" id="premiumStatus">Premium users: 0</div>
      <div class="small-muted" id="hintText">Buy premium from the banner to unlock features</div>
    </div>
  </div>

  <footer>— Aryaman Gupta —</footer>

  <script>
    /* ------------------- Config & Storage ------------------- */
    const STORAGE_KEYS = {
      PREMIUM_USERS: 'tp_premium_users_v1',     // server should populate this or admin tools; client will only read
      SELECTED_THEME: 'tp_selected_theme_v1',
      CURRENT_USER: 'tp_current_user_v1',
      PROMO_DISMISSED: 'tp_promo_dismissed_v1'
    };

    /* ------------------- Background Animation (mobile optimized) ------------------- */
    const canvas = document.getElementById('bgCanvas');
    const ctx = canvas.getContext('2d');
    let stars = [];
    let w, h;
    const isSmallScreen = () => window.innerWidth < 760;
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    function initCanvas() {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
      stars = [];
      // reduce star count on small screens to save CPU/GPU
      let starCount = 200;
      if (isSmallScreen()) starCount = Math.max(40, Math.floor(window.innerWidth / 10)); // ~40-76
      if (prefersReducedMotion) starCount = Math.min(starCount, 30);
      for(let i=0;i<starCount;i++){
        stars.push({
          x: Math.random()*w,
          y: Math.random()*h,
          r: Math.random()*1.2+0.4,
          d: Math.random()*0.6+0.2,
          vy: Math.random()*0.4 + 0.05
        });
      }
    }
    window.addEventListener('resize', () => {
      initCanvas();
    });
    initCanvas();

    // throttle frames on small screens to reduce CPU usage
    let frameCounter = 0;
    const frameSkip = isSmallScreen() ? 2 : 0; // skip 2 frames on small screens
    function animateStars(){
      frameCounter++;
      if (frameSkip > 0 && (frameCounter % (frameSkip + 1) !== 0)) {
        requestAnimationFrame(animateStars);
        return;
      }
      ctx.clearRect(0,0,w,h);
      for(let s of stars){
        ctx.beginPath();
        ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
        ctx.fillStyle = `rgba(255,255,255,${s.d})`;
        ctx.fill();
        s.y -= s.vy;
        if(s.y < -10) s.y = h + 10;
      }
      requestAnimationFrame(animateStars);
    }
    if (!prefersReducedMotion) animateStars();

    /* ------------------- Funny lines ------------------- */
    const funnyLines = [
      "Consulting alien octopi about Tuesday blues...",
      "Uploading sarcasm directly into Jupiter’s rings...",
      "Training neon llamas to run the stock market...",
      "Convincing black holes to share their secrets...",
      "Hiring AI squirrels to debug the multiverse...",
      "Brewing coffee inside a collapsing star...",
      "Teaching quantum cats to solve equations...",
      "Negotiating peace between two rival dimensions...",
      "Encrypting your bad vibes into 12D space...",
      "Installing happiness.exe in parallel realities..."
    ];

    /* ------------------- Premium list (read-only client) ------------------- */
    function loadPremiumUsers(){
      try {
        const raw = localStorage.getItem(STORAGE_KEYS.PREMIUM_USERS);
        return raw ? JSON.parse(raw) : [];
      } catch(e){ return []; }
    }
    function updateMarquee(){
      const container = document.getElementById('premiumMarquee');
      const track = document.getElementById('marqueeTrack');
      const users = loadPremiumUsers();
      if(users.length === 0){
        container.style.display = 'none';
        track.innerHTML = '';
        document.getElementById('premiumStatus').innerText = `Premium users: 0`;
        return;
      }
      const content = users.map(u => `${u}`).join(' • ');
      track.innerText = `${content}   •   ${content}`;
      container.style.display = 'flex';
      document.getElementById('premiumStatus').innerText = `Premium users: ${users.length}`;
    }

    /* ------------------- Current user & theme ------------------- */
    function normalizeName(name){ return (name||'').trim(); }
    function saveCurrentUser(name){
      name = normalizeName(name);
      if(!name) localStorage.removeItem(STORAGE_KEYS.CURRENT_USER);
      else localStorage.setItem(STORAGE_KEYS.CURRENT_USER, name);
      updateCurrentUserUI();
    }
    function loadCurrentUser(){ return localStorage.getItem(STORAGE_KEYS.CURRENT_USER) || ''; }
    function isPremium(name){
      name = normalizeName(name);
      if(!name) return false;
      const users = loadPremiumUsers();
      return users.includes(name);
    }

    function updateCurrentUserUI(){
      const name = loadCurrentUser();
      const info = document.getElementById('currentUserInfo');
      if(!name){
        info.innerText = 'No user selected';
        document.getElementById('yourName').value = '';
      } else {
        const premium = isPremium(name);
        info.innerText = `Using name: ${name} ${premium ? '— Premium' : ''}`;
      }
      updateControlsBasedOnPremium();
    }

    function updateControlsBasedOnPremium(){
      const name = loadCurrentUser();
      const daysSelect = document.getElementById('daysSelect');
      const themeSelect = document.getElementById('themeSelect');
      const isP = isPremium(name);
      const opt3 = Array.from(daysSelect.options).find(o => o.value === '3');
      if(opt3) opt3.disabled = !isP;
      Array.from(themeSelect.options).forEach(o=>{
        if(o.value === 'light' || o.value === 'neon') o.disabled = !isP;
      });
      document.getElementById('hintText').innerText = isP ? 'Premium features unlocked ✅' : 'Buy premium from banner to unlock 3-day & themes';
    }

    /* ------------------- Theme handling ------------------- */
    function applyTheme(themeVal){
      document.body.classList.remove('theme-light','theme-neon');
      if(themeVal === 'light') document.body.classList.add('theme-light');
      if(themeVal === 'neon') document.body.classList.add('theme-neon');
      localStorage.setItem(STORAGE_KEYS.SELECTED_THEME, themeVal);
    }
    function loadSavedTheme(){
      const t = localStorage.getItem(STORAGE_KEYS.SELECTED_THEME) || 'default';
      const sel = document.getElementById('themeSelect');
      if(sel) sel.value = t;
      applyTheme(t);
    }

    /* ------------------- Promo banner handling ------------------- */
    const PROMO_KEY = STORAGE_KEYS.PROMO_DISMISSED;
    function showPromoIfNeeded(){
      const dismissed = localStorage.getItem(PROMO_KEY) === '1';
      if(dismissed) return;
      // show banner
      const banner = document.getElementById('promoBanner');
      banner.style.display = 'flex';
    }
    function dismissPromo(){
      localStorage.setItem(PROMO_KEY, '1');
      const banner = document.getElementById('promoBanner');
      banner.style.display = 'none';
    }

    /* ------------------- Wire up UI events (no client-side activation) ------------------- */
    document.getElementById('closePromoBtn').addEventListener('click', ()=>{
      dismissPromo();
    });
    // Buy button: placeholder — should call server create-order and redirect to payment provider
    document.getElementById('buyPremiumBtn').addEventListener('click', ()=>{
      alert('Buy flow: frontend should call server to create an order and redirect to payment (UPI/PSP). After server-side verification premium will be activated for your account.');
      // Here implement: fetch('/api/create-order', {method:'POST', body: JSON...}) -> get payment link or UPI deeplink -> redirect
    });

    document.getElementById('saveNameBtn').addEventListener('click', ()=>{
      const name = document.getElementById('yourName').value;
      if(!name.trim()){
        alert('Please enter your name to continue.');
        return;
      }
      saveCurrentUser(name.trim());
    });

    document.getElementById('themeSelect').addEventListener('change', (e)=>{
      const selected = e.target.value;
      const current = loadCurrentUser();
      if((selected === 'light' || selected === 'neon') && !isPremium(current)){
        alert('Theme unlocked for premium users only. Buy premium from the banner.');
        e.target.value = 'default';
        applyTheme('default');
        return;
      }
      applyTheme(selected);
    });

    window.addEventListener('storage', (e)=>{
      if(e.key === STORAGE_KEYS.PREMIUM_USERS) updateMarquee();
      if(e.key === STORAGE_KEYS.CURRENT_USER) updateCurrentUserUI();
    });

    /* ------------------- Prediction logic (unchanged) ------------------- */
    function predictTomorrow() {
      let today = document.getElementById("today").value;
      let result = document.getElementById("result");
      let progressContainer = document.getElementById("progressContainer");
      let progressBar = document.getElementById("progressBar");
      let loadingText = document.getElementById("loadingText");
      const daysAhead = parseInt(document.getElementById('daysSelect').value || '1', 10);
      const currentUser = loadCurrentUser();

      if(!currentUser){
        alert('Please enter your name first (so we can check premium).');
        return;
      }

      if(today === "") {
        result.innerHTML = "⚠️ Please select today's day!";
        return;
      }

      // check premium permission for 3-day
      if(daysAhead > 2 && !isPremium(currentUser)){
        alert('3-day prediction is for premium users only. Buy premium from the banner to use this.');
        return;
      }

      result.innerHTML = "";
      progressContainer.style.display = "block";
      progressBar.style.width = "0%";
      loadingText.style.opacity = 0;
      loadingText.innerHTML = "";
      progressBar.style.animation = "none";
      void progressBar.offsetHeight;
      progressBar.style.animation = "progressAnim 8s linear forwards";

      // pick 4 random non-repeating lines
      let selected = [];
      while(selected.length < 4){
        let line = funnyLines[Math.floor(Math.random()*funnyLines.length)];
        if(!selected.includes(line)) selected.push(line);
      }

      let i = 0;
      function showLine(){
        if(i < selected.length){
          loadingText.innerHTML = selected[i];
          loadingText.style.opacity = 1;
          i++;
          setTimeout(showLine, 2000);
        }
      }
      showLine();

      setTimeout(()=> {
        let days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
        let index = days.indexOf(today);
        let outputs = [];
        for(let k=1;k<=daysAhead;k++){
          outputs.push({n:k, day: days[(index + k)%7]});
        }
        progressContainer.style.display = "none";
        loadingText.innerHTML = "";

        let html = '';
        outputs.forEach(o=>{
          if(o.n === 1) {
            html += `Tomorrow is <span style='color:var(--text);'>${o.day}</span><br/>`;
          } else {
            html += `In ${o.n} days: <span style='color:var(--text);'>${o.day}</span><br/>`;
          }
        });

        if(isPremium(currentUser)){
          html += `<div style="margin-top:8px; font-size:0.9rem; color:var(--muted)">You're a premium user ✅</div>`;
        } else {
          html += `<div style="margin-top:8px; font-size:0.9rem; color:var(--muted)">Buy premium for 3-day predictions & themes</div>`;
        }

        result.innerHTML = html;

      }, 8100);
    }

    /* ------------------- Init UI ------------------- */
    loadSavedTheme();
    updateMarquee();
    updateCurrentUserUI();
    showPromoIfNeeded();
  </script>
</body>
</html>
